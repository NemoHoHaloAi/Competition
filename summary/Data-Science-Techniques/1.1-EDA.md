# EDA - 探索性数据分析

问题：
1. 探索什么？
2. 如何探索？
3. 不同的领域、数据下的探索方式？
4. EDA如何服务于特征工程？

该篇总结来源于[这里](https://www.kaggle.com/pmarcelino/comprehensive-data-exploration-with-python)，这个kernel使用Python语言，针对House Price项目进行EDA演示，对于我而言，重点在于看到为什么要EDA，它的作用到底是什么，它的产出是什么，它如何服务于特征工程，而后者决定了机器学习的最终效果，如果只是为了EDA而EDA，那这个过程是毫无意义的；

## EDA总结 - [基于用Python进行全面的数据探索项目 by Pedro Marcelino](https://www.kaggle.com/pmarcelino/comprehensive-data-exploration-with-python)

EDA的目的在于了解数据，最初级的了解可以通过`info`、`head`、`describe`等方法对某份数据进行某个维度上的描绘，但是这些了解都是初级、肤浅的，而深入的了解往往是**费时费力**且没有太直观的收益的，因此这一步往往被忽略(或者说有意偷懒跳过，我个人就会犯这种错误)，但是如果对数据都不了解，如何能够基于数据构建有效的特征并进行预测呢，因此最好EDA的第一步也是最重要的一步就是，先**重视**它；

kernel基本流程：
1. 理解问题：研究每个特征，并从哲学角度思考它对这个问题的意义和重要性；
2. 单变量研究：只关注因变量(SalePrice)，并尝试着对它有更多了解；
3. 多变量研究：尝试理解因变量和自变量之间的关系；
4. 数据清洗：对数据缺失、异常进行处理；
5. 测试假设：检查数据是否符合大多数多元技术的假设，例如数据分布等；

## 简单记录

1. 对EDA结果的期望：
    1. 理解每个变量的含义以及它与问题的关系，为了更好的理解并整理，通常会对变量做以下分析，类似变量的元数据；
        1. 变量名；
        2. 类型：'numerical' or 'categorical'；
        3. 业务分类：对于HousePrice项目，可以分为建筑、空间、位置三类，每个变量都属于其中之一；
        4. 期望：对变量对SalePrice影响的程度，可以标记为高、中、低；
        5. 结论：与期望一样的指标；
        6. 评论：任何与变量相关的描述性信息；
    2. 期望列很重要，它有助于我们通过直观感觉判断变量的重要性，对每个变量阅读其描述后，问自己以下问题：
        1. 我买房时会考虑这个吗？
        2. 如果会考虑，它有多重要呢？
        3. 这个变量的信息是否已经在其他变量中被描述过了？
    3. 通过第二步，我们选择期望高的变量：
        1. 绘制其与SalePrice的散点图；
        2. 通过散点图的结论填写结论栏，这算是对期望的修正；
    4. 此kernel的这一步结论栏如下：
        1. OverallQual，YearBuilt，TotalBsmtSF，GrLivArea，散点图显示这几个的结论是高；
        2. 注意，由于使用的是散点图而不是箱行图，所以可能对部分分类变量不太友好，这里可视化的方式会影响结论，但是我们的目的是达到了的，即通过对变量的逐个分析，主观判断，散点图验证后，得到初步的重要变量；
    5. 为后面的探索性分析提供一个预期的方向（标记为高的变量优先分析）；
2. 分析目标变量SalePrice：
    1. 通常来说对于监督学习，永远应该先了解的变量就是我们的目标变量、因变量，此处就是SalePrice；
    2. 通过describe有效观察是否有对应业务下的异常值，极值，分布情况，百分位数等，此处看起来像是正偏；
    3. 直方图看分布情况：
        1. 有偏斜的正态分布；
        2. 正偏；
        3. 表现出峰度；
    4. 打印skew和kurt计算偏度、峰度；
    5. 研究其他变量与SalePrice的关系：
        1. 这里就用上了上面第一步的主观分析中的结论列，这些是在有大量字段时需要优先分析的；
        2. 散点图与numerical变量：`GrLivArea`与`TotalBsmtSF`都有较强的线性关系，在TotalBsmtSF中有更多处于0的数据；
        3. 箱行图与categorical变量：`OverallQual`的关系明显，而`OverallQual`相对没那么明显，但是依然可以认为人们倾向于为更新的东西付更高的价钱；
        4. 这一步结论：`GrLivArea`与`TotalBsmtSF`都与因变量有线性关系，`TotalBsmtSF`的斜率更高，`OverallQual`与因变量关系明显，而`YearBuilt`在四个中看关系是最不明显的；
        5. 当然这里只分析了四个变量是远远不够的，还有其他变量需要分析，但是这里的目的在于找到有用的变量，而不是变量间的复杂关系；
3. 之前第一二步中，驱动我们的主要是主观思维，而工程是需要可管理性的分析的，因此接下来就是客观分析：
    1. 为了客观的理解变量与目标间的关系，我们将借助以下三种方式：
        1. 热图形式的相关性矩阵；
        2. SalePrice的关联矩阵；
        3. TopN相关变量的散点、箱行图；
    2. 相关矩阵：
        1. 观察特征之间相关性，这可能表现不同变量间携带同样的信息；
        2. 观察与SalePrice间的相关性，找出重要的变量，这里可以看到我们猜测的`GrLivArea`，`TotalBsmtSF`，`OverallQual`，但是也看到其他要考虑但是之前主观分析没有注意到的，这就是这一步的主要作用；
    3. 与SalePrice的关联矩阵：
        1. 选择与SalePrice相关性最强的Top10；
        2. 继续绘制矩阵，分析与SalePrice相关性，与其他重要变量的相关性；
        3. `OverallQual`是最相关的；
        4. 例如`GrLivArea`与`TotRmsAbvGrd`相关性高达0.82，去掉后一个，其余类似情况一样处理；
        5. 最终留下：'SalePrice', 'OverallQual', 'GrLivArea', 'GarageCars', 'TotalBsmtSF', 'FullBath', 'YearBuilt'；
    4. 直接绘制这7个特征的可视化，该过程一些有趣的收获：
        1. `TotalBsmtSF`和`GrLiveArea`散点图显示，GrLiveArea总是大于等于TotalBsmtSF，这很合理，除非你买的是一整个地下室；
        2. `SalePrice`和`YearBuilt`关系看起来像是一条指数图像，这说明近几年放假涨的真的很快，即便是去掉通货膨胀后来看依然如此；
4. 处理缺失数据：
    1. 考虑两个有关的问题：
        1. 丢失情况有多普遍，也就是丢失率；
        2. 丢失的数据是随机的还是有规律的，通常来说随机的较难填充，而有规律的可以依据规律进行处理；
    2. 对有缺失的变量的处理：
        1. 删除缺失率高于15%(可以调整)的变量，关键是：
            1. 缺失率是否过高，过高的缺失率通常意味着无法很好的进行填充，且可能引入噪声；
            2. 是否会丢失重要信息：目前这里缺失多的变量看起来以及在上面的可视化中没有表现出很强的相关性；
            3. 部分缺失多的变量同时也很有可能是噪声的主要来源，可能这也是他们缺失的原因，因为太不重要；
        2. 删除有规律的一系列缺失且信息已经被其他变量携带的变量：
            1. 几个同类变量缺失数据量一直，可能就是有规律的缺失；
            2. 这些变量同样被其他变量所表达了；
        3. 对于很少的缺失，可以考虑删除对应行而不是列；
    3. 这里的缺失处理偏保守和简单，通常来说效果会不错，但是过于粗暴，可能会丢失一部分信息，但是也可能会删除掉噪声，所以不好直接评价，具体还是看具体问题分析吧，这里的数据特点允许这样处理的主要原因是缺失的都不是重要变量，所以删除好于填充；
5. 处理异常、离群值：
    1. 离群值也是个需要重点关注的对象，因为它可能显著的影响模型的行为，而且有些离群值对于我们理解问题是有帮助的；
    2. 单变量分析：通过对`SalePrice`进行标准化后排序观察其值与0的距离，距离越远越有可能是极值，通常这里只是辅助分析不会直接断定；
    3. 双变量分析：通过散点图等观察`SalePrice`与主要的重要数值变量的分布是否有远离分布主体，明显不符合分布趋势的；
6. 了解`SalePrice`是否符合统计假设：
    1. 正态性：不仅仅是`SalePrice`，其他重要变量也最好是满足正态性的；
        1. 通过直方图、正态概率图观察，偏度、峰度等打印；
        2. 正偏情况通过log1p转换处理最好（转换方式还有box-cox等）；
        3. 对于包含0的列转换要特别处理，因为log不允许0，可以单独对非0部分做转换；
    2. 同质性；
        1. 做log变换前的`GrLivArea`与`SalePrice`散点图有圆锥形体现，这就是不满足同质性的表现；
        2. 不过做了满足正态处理后，已经看不到了；
    3. 线性：这里变量之间普遍存在线性关系，因此不需要考虑；
    4. 减少相关错误；
7. categorical变量做dummy编码处理；

## 问题的答案

针对Recruit项目做反向EDA，来看看FE部分的特征可视化后到底表现如何？

## 最后
